<!DOCTYPE html>  
<html><head><meta charset="utf-8">
<script type="text/javascript" src="jsWaffle.js"></script>
<script>
window.onload = function() {
	var calcHistory = [];
	var buttons = [
		['C','H','BS','*'],
		['7','8','9','/'],
		['4','5','6','+'],
		['1','2','3','-'],
		['0','.','%','=']
	];
	// 動態建立按鍵
	for (var y = 0; y < buttons.length; y++) {
		var div = document.createElement("div");
		var bline = buttons[y];
		for (var x = 0; x < bline.length; x++) {
			var ch = bline[x];
			var btn = document.createElement("button");
			btn.innerHTML = btn.value = ch;
			btn.onclick = buttonClickHandler;
			div.appendChild(btn);
		}
		$("mainPanel").appendChild(div);
	}
	// 按下按鍵時所執行的動作
	function buttonClickHandler(e) {
		var num_txt = $("num_txt");
		var ch = e.target.value;
		if (ch == "=") { // 計算總合
			try {
				var exp = num_txt.value;
				var ans = eval(exp);
				num_txt.value = ans;
				calcHistory.push(exp);
			} catch(e) {
				alert(e.message); // 顯示計算式有誤
			}
		} else if (ch == "BS") { // 退回一個字元
			var s = num_txt.value;
			num_txt.value = s.substr(0, s.length - 1);
		} else if(ch == "C"){ // 清除鍵
			num_txt.value = "0";
			calcHistory = [];
		} else if (ch == "H"){ // 顯示歷史記錄鍵
			if (calcHistory.length > 0) {
				num_txt.value = calcHistory.pop();
			}
		} else {
			if (num_txt.value == "0") num_txt.value = "";
			num_txt.value = num_txt.value + ch;
		}
	}
};
</script>
<style>
	*  { margin:0; padding:0; font-size:32px; }
	body { text-align:center; background-color:black; }
	h1 { background-color: blue; color: white; padding:8px; font-size:20px; }
	button{ width:64px; height:64px; margin:2px; }
	#num_txt { width:80%; padding:8px; margin:8px; text-align:right; }
</style>
</head><body><h1>計算機</h1>
	<input id="num_txt" type="text" value="0" />
	<div id="mainPanel"></div>
</body></html>